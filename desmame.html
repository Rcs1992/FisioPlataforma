<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Formulário de Desmame e Extubação</title>
    <style>
  <style>
    body {
        font-family: Arial, sans-serif;
        background-color: #e9e9e9;
        margin: 0;
        padding: 20px;
        color: #222;
    }
    .container {
        max-width: 800px;
        margin: 0 auto;
        padding: 20px;
        background: #fff;
        border-radius: 8px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
    }
    h1 {
        text-align: center;
        color: #8B0000;
    }
    .section {
        margin-bottom: 20px;
    }
    .section h2 {
        border-bottom: 2px solid #8B0000;
        padding-bottom: 10px;
        color: #8B0000;
    }

    label {
        display: block;
        margin-bottom: 10px;
        font-weight: bold;
        color: #333;
    }
    input[type="text"], input[type="number"], input[type="email"] {
        width: calc(100% - 22px);
        padding: 10px;
        margin: 5px 0;
        border: 1px solid #aaa;
        border-radius: 4px;
    }
    input[type="radio"] {
        margin-right: 10px;
    }
    .alert {
        color: #b22222;
        font-weight: bold;
        margin-top: 10px;
    }
    .success {
        color: #444;
        font-weight: bold;
    }
    button {
        padding: 10px 20px;
        background-color: #8B0000;
        border: none;
        color: white;
        border-radius: 4px;
        cursor: pointer;
        font-size: 16px;
        margin-right: 10px;
    }
    button:hover {
        background-color: #600000;
    }
    .checklist-item {
        margin-bottom: 10px;
    }
    
    .checklist-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 8px 0;
    border-bottom: 1px solid #ccc;
    font-size: 15px;
}

.checklist-label {
    flex: 1;
    color: #333;
}

.checklist-options {
    display: flex;
    gap: 20px;
}

.checklist-options label {
    font-weight: normal;
    color: #111;
    display: flex;
    align-items: center;
    gap: 5px;
}
</style>
</head>
<body>
    <div class="container">
        <h1>Formulário de Desmame e Extubação</h1>
        <div class="section">
            <h2>Informações do Paciente</h2>
            <label for="nome">Nome do Paciente:</label>
            <input type="text" id="nome" required>
            <label for="prontuario">Prontuário:</label>
            <input type="text" id="prontuario" required>
        </div>
<div class="section">
    <h2>Checklist Inicial para Extubação</h2>
    <div class="checklist-item">
        <div class="checklist-label">Reversibilidade do quadro:</div>
        <div class="checklist-options">
            <label><input type="radio" name="reversibilidade" value="sim"> SIM</label>
            <label><input type="radio" name="reversibilidade" value="nao"> NÃO</label>
        </div>
    </div>

    <div class="checklist-item">
        <div class="checklist-label">Glasgow &gt; 8:</div>
        <div class="checklist-options">
            <label><input type="radio" name="glasgow" value="sim"> SIM</label>
            <label><input type="radio" name="glasgow" value="nao"> NÃO</label>
        </div>
    </div>

    <div class="checklist-item">
        <div class="checklist-label">Estabilidade hemodinâmica:</div>
        <div class="checklist-options">
            <label><input type="radio" name="hemodinamica" value="sim"> SIM</label>
            <label><input type="radio" name="hemodinamica" value="nao"> NÃO</label>
        </div>
    </div>

    <div class="checklist-item">
        <div class="checklist-label">Hemoglobina &gt; 8 g/dL:</div>
        <div class="checklist-options">
            <label><input type="radio" name="hemoglobina" value="sim"> SIM</label>
            <label><input type="radio" name="hemoglobina" value="nao"> NÃO</label>
        </div>
    </div>

    <div class="checklist-item">
        <div class="checklist-label">Afebril:</div>
        <div class="checklist-options">
            <label><input type="radio" name="afebril" value="sim"> SIM</label>
            <label><input type="radio" name="afebril" value="nao"> NÃO</label>
        </div>
    </div>

    <div class="checklist-item">
        <div class="checklist-label">Balanço hídrico zerado ou negativo:</div>
        <div class="checklist-options">
            <label><input type="radio" name="balanco" value="sim"> SIM</label>
            <label><input type="radio" name="balanco" value="nao"> NÃO</label>
        </div>
    </div>

    <div class="checklist-item">
        <div class="checklist-label">Trocas gasosas adequadas:</div>
        <div class="checklist-options">
            <label><input type="radio" name="gasosas" value="sim"> SIM</label>
            <label><input type="radio" name="gasosas" value="nao"> NÃO</label>
        </div>
    </div>

    <div class="checklist-item">
        <div class="checklist-label">Capacidade de proteger vias aéreas:</div>
        <div class="checklist-options">
            <label><input type="radio" name="vias" value="sim"> SIM</label>
            <label><input type="radio" name="vias" value="nao"> NÃO</label>
        </div>
    </div>

    <div class="checklist-item">
        <div class="checklist-label">Sem cirurgia programada em 48h:</div>
        <div class="checklist-options">
            <label><input type="radio" name="cirurgia" value="sim"> SIM</label>
            <label><input type="radio" name="cirurgia" value="nao"> NÃO</label>
        </div>
    </div>

    <div class="checklist-item">
        <div class="checklist-label">Cuff Leak Test positivo (inicial):</div>
        <div class="checklist-options">
            <label><input type="radio" name="cuffchecklist" value="sim"> SIM</label>
            <label><input type="radio" name="cuffchecklist" value="nao"> NÃO</label>
        </div>
    </div>
</div>
    <button onclick="verificarChecklist()" style="margin: 10px 0;">Verificar Checklist</button>

        <div class="section">
            <h2>Estratégia de Desmame</h2>
            <label><input type="radio" name="estrategia" value="pecaT"> TRE em Peça T</label>
            <label><input type="radio" name="estrategia" value="ps5"> TRE com PS 5 e PEEP de 5</label>
        </div>

        <div class="section">
            <h2>Dados do TRE</h2>
            <label for="irrs-inicio">IRRS no Início:</label>
            <input type="number" id="irrs-inicio" required>
            <label for="irrs-fim">IRRS no Fim:</label>
            <input type="number" id="irrs-fim" required>
        </div>

        <div class="section">
            <h2>Pressão Inspiratória Máxima</h2>
            <label for="pressao-inspiratoria">Pressão Inspiratória Máxima (cmH2O):</label>
            <input type="number" id="pressao-inspiratoria" required>
        </div>

        <div class="section">
            <h2>Cuff Leak Test</h2>
            <label><input type="radio" name="cuff" value="positivo"> Positivo</label>
            <label><input type="radio" name="cuff" value="negativo"> Negativo</label>
        </div>

        <div class="section">
            <h2>Email para Envio</h2>
            <label for="email">Endereço de Email:</label>
            <input type="email" id="email" required>
        </div>

        <div class="section">
            <button onclick="validarTRE()">Validar TRE</button>
            <button onclick="gerarPDF()">Gerar PDF</button>
            <button onclick="enviarEmail()">Enviar e-mail</button>
        </div>

        <div class="section">
            <h2>Mensagens de Validação</h2>
            <div id="mensagem-validacao"></div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script>
       
       function verificarChecklist() {
    const itens = [
        "reversibilidade",
        "glasgow",
        "hemodinamica",
        "hemoglobina",
        "afebril",
        "balanco",
        "gasosas",
        "vias",
        "cirurgia",
        "cuffchecklist"
    ];

    let incompletos = [];
    let negativos = [];

    itens.forEach(nome => {
        const selecionado = document.querySelector(`input[name="${nome}"]:checked`);
        if (!selecionado) {
            incompletos.push(nome);
        } else if (selecionado.value === "nao") {
            negativos.push(nome);
        }
    });

    if (incompletos.length > 0) {
        alert(`Faltam itens para marcar no checklist:\n\n${incompletos.map(n => formatarItem(n)).join("\n")}`);
        return false;
    }

    if (negativos.length > 0) {
        alert(`Atenção: Os seguintes itens estão marcados como NÃO:\n\n${negativos.map(n => formatarItem(n)).join("\n")}\n\nRecomenda-se reavaliação antes de prosseguir.`);
        return false;
    }

    alert("Checklist completo e sem alertas. OK para continuar.");
    return true;
}

function formatarItem(nome) {
    const nomesLegiveis = {
        reversibilidade: "Reversibilidade do quadro",
        glasgow: "Glasgow > 8",
        hemodinamica: "Estabilidade hemodinâmica",
        hemoglobina: "Hemoglobina > 8 g/dL",
        afebril: "Afebril",
        balanco: "Balanço hídrico zerado ou negativo",
        gasosas: "Trocas gasosas adequadas",
        vias: "Capacidade de proteger vias aéreas",
        cirurgia: "Sem cirurgia programada em 48h",
        cuffchecklist: "Cuff Leak Test positivo (inicial)"
    };
    return nomesLegiveis[nome] || nome;
}

        function validarTRE() {
            let nome = document.getElementById("nome").value;
            let prontuario = document.getElementById("prontuario").value;
            let estrategia = document.querySelector('input[name="estrategia"]:checked');
            let irrsInicio = document.getElementById("irrs-inicio").value;
            let irrsFim = document.getElementById("irrs-fim").value;
            let pressaoInspiratoria = document.getElementById("pressao-inspiratoria").value;
            let cuffLeak = document.querySelector('input[name="cuff"]:checked');
            let mensagemValidacao = document.getElementById("mensagem-validacao");

            if (!nome || !prontuario || !estrategia || !irrsInicio || !irrsFim || !pressaoInspiratoria || !cuffLeak) {
                mensagemValidacao.innerHTML = '<span class="alert">Por favor, preencha todos os campos antes de validar.</span>';
                return false;
            }

            let estrategiaValue = estrategia.value;
            let irrsInicioValue = parseFloat(irrsInicio);
            let irrsFimValue = parseFloat(irrsFim);
            let pressaoInspiratoriaValue = parseFloat(pressaoInspiratoria);
            let cuffLeakValue = cuffLeak.value;

            let alertas = '';
            let corteIRRS = estrategiaValue === 'pecaT' ? 105 : 75;
            let variacaoIRRS = verificarVariacaoIRRS(irrsInicioValue, irrsFimValue);

            if (irrsFimValue >= corteIRRS) {
                alertas += 'A IRRS no final está acima do ponto de corte, indicando risco de falha de extubação.<br>';
            }

            if (variacaoIRRS) {
                alertas += variacaoIRRS + '<br>';
            }

            if (pressaoInspiratoriaValue < 20) {
                alertas += 'A pressão inspiratória máxima está abaixo do ponto de corte, indicando fraqueza muscular que pode prejudicar o desmame.<br>';
            }

            if (cuffLeakValue === 'negativo') {
                alertas += 'O cuff leak test foi negativo. O fisioterapeuta deve conversar com o médico sobre o uso de corticoide.<br>';
            }

            if (alertas === '') {
                mensagemValidacao.innerHTML = '<span class="success">Todos os dados estão corretos e não há alertas.</span>';
            } else {
                mensagemValidacao.innerHTML = alertas;
            }

            return true;
        }

        function verificarVariacaoIRRS(irrsInicio, irrsFim) {
            if (irrsFim > irrsInicio) {
                let variacao = ((irrsFim - irrsInicio) / irrsInicio) * 100;
                if (variacao >= 20) {
                    return `A variação do IRRS foi de ${variacao.toFixed(2)}%, sugerindo risco de falha de extubação.`;
                }
            }
            return '';
        }

function gerarPDF() {
    if (!verificarChecklist() || !validarTRE()) return;

    const { jsPDF } = window.jspdf;
    let doc = new jsPDF();

    let nome = document.getElementById("nome").value;
    let prontuario = document.getElementById("prontuario").value;
    let estrategia = document.querySelector('input[name="estrategia"]:checked').value;
    let irrsInicio = document.getElementById("irrs-inicio").value;
    let irrsFim = document.getElementById("irrs-fim").value;
    let pressaoInspiratoria = document.getElementById("pressao-inspiratoria").value;
    let cuffLeak = document.querySelector('input[name="cuff"]:checked').value;
    let mensagemValidacao = document.getElementById("mensagem-validacao").innerHTML;

    // Dados do checklist
    const checklist = [
        { nome: "Reversibilidade do quadro", campo: "reversibilidade" },
        { nome: "Glasgow > 8", campo: "glasgow" },
        { nome: "Estabilidade hemodinâmica", campo: "hemodinamica" },
        { nome: "Hemoglobina > 8 g/dL", campo: "hemoglobina" },
        { nome: "Afebril", campo: "afebril" },
        { nome: "Balanço hídrico zerado ou negativo", campo: "balanco" },
        { nome: "Trocas gasosas adequadas", campo: "gasosas" },
        { nome: "Capacidade de proteger vias aéreas", campo: "vias" },
        { nome: "Sem cirurgia programada em 48h", campo: "cirurgia" },
        { nome: "Cuff Leak Test positivo (inicial)", campo: "cuffchecklist" }
    ];

    // Cabeçalho
    doc.setFontSize(16);
    doc.setFont("helvetica", "bold");
    doc.text("Relatório de Desmame e Extubação", 20, 20);

    doc.setFontSize(12);
    doc.setFont("helvetica", "normal");
    doc.text(`Nome do Paciente: ${nome}`, 20, 30);
    doc.text(`Prontuário: ${prontuario}`, 20, 40);

    // Checklist com fundo cinza
    doc.setFillColor(230, 230, 230);
    doc.rect(10, 45, 190, 12, "F");
    doc.setFontSize(14);
    doc.setTextColor(0, 0, 0);
    doc.setFont("helvetica", "bold");
    doc.text("Checklist Inicial", 15, 53);

    let y = 60;
    doc.setFontSize(12);
    doc.setFont("helvetica", "normal");

    checklist.forEach(item => {
        const valor = getRadioValue(item.campo);
        if (valor === "nao") {
            doc.setTextColor(200, 0, 0); // vermelho para NÃO
        } else {
            doc.setTextColor(50, 50, 50); // cinza escuro para SIM
        }
        doc.text(`${item.nome}: ${valor.toUpperCase()}`, 15, y);
        y += 7;
    });

    // Barra azul para dados do TRE
    y += 5;
    doc.setFillColor(240, 240, 255);
    doc.rect(10, y, 190, 10, "F");
    doc.setTextColor(0, 0, 0);
    doc.setFont("helvetica", "bold");
    doc.text("Dados do TRE", 15, y + 7);
    y += 15;

    doc.setFont("helvetica", "normal");
    doc.text(`Estratégia de Desmame: ${estrategia}`, 15, y); y += 7;
    doc.text(`IRRS no Início: ${irrsInicio}`, 15, y); y += 7;
    doc.text(`IRRS no Fim: ${irrsFim}`, 15, y); y += 7;
    doc.text(`Pressão Inspiratória Máxima: ${pressaoInspiratoria}`, 15, y); y += 7;
    doc.text(`Cuff Leak Test (final): ${cuffLeak}`, 15, y); y += 12;

    // Mensagens de validação
    if (mensagemValidacao) {
        doc.setFont("helvetica", "bold");
        doc.text("Mensagens de Validação:", 15, y);
        y += 8;
        doc.setFont("helvetica", "italic");

        let mensagens = mensagemValidacao.replace(/<br>/g, "\n").trim();
        let linhas = doc.splitTextToSize(mensagens, 180);
        doc.text(linhas, 15, y);
    }

    doc.save('relatorio-desmame-extubacao.pdf');
}

// Função auxiliar para pegar valor de radio buttons
function getRadioValue(name) {
    let radios = document.querySelectorAll(`input[name="${name}"]`);
    for (let r of radios) {
        if (r.checked) return r.value;
    }
    return "não informado";
}
function enviarEmail() {
    if (!verificarChecklist() || !validarTRE()) return;

    let nome = document.getElementById("nome").value;
    let prontuario = document.getElementById("prontuario").value;
    let estrategia = document.querySelector('input[name="estrategia"]:checked').value;
    let irrsInicio = document.getElementById("irrs-inicio").value;
    let irrsFim = document.getElementById("irrs-fim").value;
    let pressaoInspiratoria = document.getElementById("pressao-inspiratoria").value;
    let cuffLeak = document.querySelector('input[name="cuff"]:checked').value;
    let email = document.getElementById("email").value;
    let mensagemValidacao = document.getElementById("mensagem-validacao").innerHTML;

    // Checklist
    const checklist = [
        { nome: "Reversibilidade do quadro", campo: "reversibilidade" },
        { nome: "Glasgow > 8", campo: "glasgow" },
        { nome: "Estabilidade hemodinâmica", campo: "hemodinamica" },
        { nome: "Hemoglobina > 8 g/dL", campo: "hemoglobina" },
        { nome: "Afebril", campo: "afebril" },
        { nome: "Balanço hídrico zerado ou negativo", campo: "balanco" },
        { nome: "Trocas gasosas adequadas", campo: "gasosas" },
        { nome: "Capacidade de proteger vias aéreas", campo: "vias" },
        { nome: "Sem cirurgia programada em 48h", campo: "cirurgia" },
        { nome: "Cuff Leak Test positivo (inicial)", campo: "cuffchecklist" }
    ];

    let checklistTexto = checklist.map(item => {
        const valor = getRadioValue(item.campo);
        const alerta = valor === "nao" ? " ⚠" : "";
        return `${item.nome}: ${valor.toUpperCase()}${alerta}`;
    }).join("\n");

    let dadosPaciente = `
Relatório de Desmame e Extubação

Nome: ${nome}
Prontuário: ${prontuario}

CHECKLIST INICIAL:
${checklistTexto}

DADOS DO TRE:
Estratégia de Desmame: ${estrategia}
IRRS Início: ${irrsInicio}
IRRS Fim: ${irrsFim}
Pressão Inspiratória Máxima: ${pressaoInspiratoria}
Cuff Leak Test (final): ${cuffLeak}

Mensagens de Validação:
${mensagemValidacao.replace(/<br>/g, "\n")}
    `;

    window.open(`mailto:${email}?subject=Relatório de Desmame&body=${encodeURIComponent(dadosPaciente)}`);
}
  </script>
</body>
</html>
