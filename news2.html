<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=yes" />
  <meta name="theme-color" content="#1e56d7" />
  <title>NEWS2 — Calculadora Clínica</title>
  <style>
    * {
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent;
    }

    :root {
      --bg: #eaf2ff;
      --card: #ffffff;
      --primary: #1e56d7;
      --primary-600: #1646b0;
      --muted: #6b7a9a;
      --accent: #cfe0ff;
      --shadow: 0 4px 12px rgba(30, 86, 215, 0.12);
      --radius: 16px;
      --gap: 12px;
      --safe-bottom: env(safe-area-inset-bottom, 0px);
    }

    html, body {
      height: 100%;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
      background: linear-gradient(180deg, var(--bg), #f4f8ff);
      color: #0b1a33;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      padding: 12px 12px var(--safe-bottom);
    }

    .container {
      max-width: 480px;
      margin: 0 auto;
      width: 100%;
    }

    /* Header melhorado para mobile */
    header {
      display: flex;
      gap: 12px;
      align-items: center;
      margin-bottom: 16px;
      background: rgba(255, 255, 255, 0.6);
      backdrop-filter: blur(8px);
      -webkit-backdrop-filter: blur(8px);
      padding: 8px 12px;
      border-radius: 20px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.02);
    }

    .logo {
      width: 48px;
      height: 48px;
      border-radius: 14px;
      background: linear-gradient(135deg, var(--primary), var(--primary-600));
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-weight: 800;
      font-size: 16px;
      box-shadow: 0 6px 12px rgba(30, 86, 215, 0.2);
      flex-shrink: 0;
    }

    .header-text {
      flex: 1;
    }

    h1 {
      font-size: 17px;
      margin: 0 0 2px 0;
      font-weight: 700;
      line-height: 1.3;
    }

    p.lead {
      margin: 0;
      color: var(--muted);
      font-size: 13px;
      line-height: 1.4;
    }

    /* Cards com melhor toque visual */
    .card {
      background: var(--card);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 16px;
      margin-bottom: 16px;
      border: 1px solid rgba(255,255,255,0.5);
      transition: transform 0.1s ease;
    }

    /* Presets como chips touch-friendly */
    .presets {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      margin: 12px 0 4px;
    }

    .preset-btn {
      padding: 12px 16px;
      border-radius: 40px;
      border: 1px solid rgba(30, 86, 215, 0.15);
      background: white;
      cursor: pointer;
      font-weight: 600;
      font-size: 14px;
      color: var(--primary);
      box-shadow: 0 2px 6px rgba(30, 86, 215, 0.04);
      transition: all 0.2s ease;
      flex: 0 1 auto;
      min-width: calc(33.33% - 8px);
      text-align: center;
      -webkit-touch-callout: none;
      -webkit-user-select: none;
      user-select: none;
      touch-action: manipulation;
    }

    .preset-btn:active {
      background: var(--accent);
      transform: scale(0.97);
    }

    /* Melhorias nos selects para mobile */
    select {
      width: 100%;
      padding: 14px 12px;
      border-radius: 14px;
      border: 1.5px solid #e3eaf8;
      font-size: 16px; /* Evita zoom no iOS */
      background: #fbfdff;
      appearance: none;
      -webkit-appearance: none;
      background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%231e56d7' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
      background-repeat: no-repeat;
      background-position: right 12px center;
      background-size: 18px;
      font-family: inherit;
      margin: 4px 0;
    }

    select:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(30, 86, 215, 0.1);
    }

    label {
      font-size: 14px;
      font-weight: 600;
      color: #0b2545;
      display: block;
      margin-bottom: 2px;
      margin-left: 4px;
    }

    .small {
      font-size: 12px;
      color: var(--muted);
      margin-top: 4px;
      margin-left: 4px;
    }

    /* Grid melhorado para mobile */
    .grid {
      display: flex;
      flex-direction: column;
      gap: 16px;
    }

    /* Botões grandes e táteis */
    .actions {
      display: flex;
      gap: 10px;
      margin-top: 20px;
    }

    button {
      min-height: 52px;
      font-size: 16px;
      border-radius: 14px;
      border: none;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.2s ease;
      touch-action: manipulation;
      -webkit-touch-callout: none;
    }

    button.primary {
      flex: 2;
      background: linear-gradient(180deg, var(--primary), var(--primary-600));
      color: white;
      box-shadow: 0 8px 16px rgba(30, 86, 215, 0.25);
    }

    button.primary:active {
      opacity: 0.9;
      transform: translateY(1px);
      box-shadow: 0 4px 8px rgba(30, 86, 215, 0.3);
    }

    button.ghost {
      flex: 1;
      background: white;
      border: 1.5px solid rgba(30, 86, 215, 0.15);
      color: var(--primary);
    }

    button.ghost:active {
      background: #f0f5ff;
    }

    /* Resultado com visual melhorado */
    .result {
      padding: 20px;
      animation: slideUp 0.3s ease;
    }

    @keyframes slideUp {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .scoreline {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 16px;
      background: linear-gradient(135deg, #f8fbff, #f0f5ff);
      padding: 12px;
      border-radius: 20px;
    }

    .pill {
      background: linear-gradient(135deg, var(--primary), var(--primary-600));
      color: white;
      padding: 12px 20px;
      border-radius: 40px;
      font-weight: 900;
      font-size: 28px;
      line-height: 1;
      box-shadow: 0 8px 20px rgba(30, 86, 215, 0.25);
      min-width: 70px;
      text-align: center;
    }

    .param-list {
      display: flex;
      flex-direction: column;
      gap: 8px;
      margin: 16px 0;
    }

    .param {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-weight: 600;
      padding: 12px;
      border-radius: 14px;
      background: #f8faff;
      border: 1px solid rgba(30, 86, 215, 0.06);
      font-size: 15px;
    }

    .param .val {
      background: white;
      padding: 6px 14px;
      border-radius: 30px;
      font-weight: 700;
      color: var(--primary);
      box-shadow: 0 2px 6px rgba(0,0,0,0.02);
    }

    .interpret {
      padding: 16px;
      border-radius: 16px;
      font-weight: 700;
      font-size: 16px;
      text-align: center;
      margin: 16px 0;
    }

    .low { background: #e8f7f2; border: 1px solid #b8e6d9; color: #0b6e4f; }
    .lowmedium { background: #fff4e5; border: 1px solid #ffe0b2; color: #8a5a00; }
    .med { background: #fff0d9; border: 1px solid #ffd699; color: #b25700; }
    .high { background: #fee9e9; border: 1px solid #fcc; color: #b91c1c; }

    /* Área de resposta melhorada */
    .response-block {
      background: white;
      border-radius: 20px;
      padding: 18px;
      border: 1px solid rgba(30, 86, 215, 0.1);
      box-shadow: 0 4px 12px rgba(0,0,0,0.02);
    }

    .response-title {
      font-weight: 800;
      color: var(--primary);
      font-size: 18px;
      margin-bottom: 12px;
    }

    .response-block ul {
      margin: 8px 0 0 0;
      padding-left: 20px;
    }

    .response-block li {
      margin: 10px 0;
      line-height: 1.4;
      font-size: 15px;
    }

    /* Footer */
    footer {
      font-size: 11px;
      color: var(--muted);
      margin-top: 24px;
      text-align: center;
      padding: 12px;
      background: rgba(255,255,255,0.5);
      border-radius: 30px;
    }

    /* Divisor */
    hr {
      border: none;
      border-top: 1px solid rgba(30, 86, 215, 0.08);
      margin: 16px 0;
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div class="logo">NEWS2</div>
      <div class="header-text">
        <h1>Calculadora NEWS2</h1>
        <p class="lead">Escolha a faixa para cada parâmetro</p>
      </div>
    </header>

    <div class="card">
      <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
        <strong style="font-size: 15px;">Presets rápidos</strong>
        <span class="small">Toque para aplicar</span>
      </div>

      <div class="presets">
        <button class="preset-btn" data-preset="normal">Normal</button>
        <button class="preset-btn" data-preset="hipoxia-leve">Hipóxia leve</button>
        <button class="preset-btn" data-preset="hipoxia-grave">Hipóxia grave</button>
        <button class="preset-btn" data-preset="instavel">Instável</button>
        <button class="preset-btn" data-preset="bradicardia">Bradicardia</button>
        <button class="preset-btn" data-preset="febre">Febre alta</button>
      </div>

      <hr>

      <form id="newsForm">
        <div class="grid">
          <!-- Respiratory rate -->
          <div>
            <label for="rr">Frequência respiratória (irpm)</label>
            <select id="rr">
              <option value="3">≤ 8 — 3 pontos</option>
              <option value="1">9-11 — 1 ponto</option>
              <option value="0" selected>12-20 — 0 pontos</option>
              <option value="2">21-24 — 2 pontos</option>
              <option value="3">≥ 25 — 3 pontos</option>
            </select>
          </div>

          <!-- SpO2 scale -->
          <div>
            <label for="spO2Scale">Escala SpO₂</label>
            <select id="spO2Scale">
              <option value="1" selected>Escala 1 — paciente padrão</option>
              <option value="2">Escala 2 — risco de hipercapnia</option>
            </select>
          </div>

          <!-- Oxygen source -->
          <div>
            <label for="oxygenSource">Suplemento de O₂</label>
            <select id="oxygenSource">
              <option value="room" selected>Ar ambiente</option>
              <option value="supp">O₂ suplementar</option>
            </select>
          </div>

          <!-- SpO2 value -->
          <div>
            <label for="spO2">SpO₂ — faixa</label>
            <select id="spO2"></select>
            <div class="small" id="spO2Help">Selecione escala e fonte</div>
          </div>

          <!-- Systolic BP -->
          <div>
            <label for="sbp">PA sistólica (mmHg)</label>
            <select id="sbp">
              <option value="3">≤ 90 — 3 pontos</option>
              <option value="2">91–100 — 2 pontos</option>
              <option value="1">101–110 — 1 ponto</option>
              <option value="0" selected>111–219 — 0 pontos</option>
              <option value="3">≥ 220 — 3 pontos</option>
            </select>
          </div>

          <!-- Pulse -->
          <div>
            <label for="hr">Pulso (bpm)</label>
            <select id="hr">
              <option value="3">≤ 40 — 3 pontos</option>
              <option value="1">41–50 — 1 ponto</option>
              <option value="0" selected>51–90 — 0 pontos</option>
              <option value="1">91–110 — 1 ponto</option>
              <option value="2">111–130 — 2 pontos</option>
              <option value="3">≥ 131 — 3 pontos</option>
            </select>
          </div>

          <!-- Consciousness -->
          <div>
            <label for="conscious">Consciência</label>
            <select id="conscious">
              <option value="0" selected>Alerta — 0 pontos</option>
              <option value="3">Nova confusão / não responsivo — 3 pontos</option>
            </select>
          </div>

          <!-- Temperature -->
          <div>
            <label for="temp">Temperatura (°C)</label>
            <select id="temp">
              <option value="3">≤ 35.0 — 3 pontos</option>
              <option value="1">35.1–36.0 — 1 ponto</option>
              <option value="0" selected>36.1–38.0 — 0 pontos</option>
              <option value="1">38.1–39.0 — 1 ponto</option>
              <option value="2">≥ 39.1 — 2 pontos</option>
            </select>
          </div>
        </div>

        <div class="actions">
          <button class="primary" id="calcBtn" type="button">Calcular NEWS2</button>
          <button class="ghost" id="clearBtn" type="button">Limpar</button>
        </div>
      </form>
    </div>

    <!-- Resultado -->
    <div class="card result" id="output" hidden>
      <div class="scoreline">
        <div>
          <div class="small">NEWS2 total</div>
          <div class="pill" id="totalScore">0</div>
        </div>
        <div style="text-align: right;">
          <div class="small" id="scoreTag">—</div>
          <div class="small" id="updatedAt"></div>
        </div>
      </div>

      <div class="param-list">
        <div class="param"><span>Respiração</span><span class="val" id="score_rr">0</span></div>
        <div class="param"><span>SpO₂</span><span class="val" id="score_spO2">0</span></div>
        <div class="param"><span>PA sistólica</span><span class="val" id="score_sbp">0</span></div>
        <div class="param"><span>Pulso</span><span class="val" id="score_hr">0</span></div>
        <div class="param"><span>Consciência</span><span class="val" id="score_conscious">0</span></div>
        <div class="param"><span>Temperatura</span><span class="val" id="score_temp">0</span></div>
        <div class="param"><span>O₂ suplementar</span><span class="val" id="score_o2uplift">0</span></div>
      </div>

      <div id="interpret" class="interpret low">Interpretação</div>

      <div id="responseArea" class="response-block">
        <div class="response-title">O que fazer?</div>
        <div id="responseContent"></div>
      </div>

      <div class="small" style="margin-top: 16px;">Sempre associar à avaliação clínica</div>
    </div>

    <footer>
      NEWS2 — Royal College of Physicians
    </footer>
  </div>

  <script>
    (function() {
      const elems = {
        rr: document.getElementById('rr'),
        spO2: document.getElementById('spO2'),
        spO2Scale: document.getElementById('spO2Scale'),
        oxygenSource: document.getElementById('oxygenSource'),
        sbp: document.getElementById('sbp'),
        hr: document.getElementById('hr'),
        conscious: document.getElementById('conscious'),
        temp: document.getElementById('temp'),
        calcBtn: document.getElementById('calcBtn'),
        clearBtn: document.getElementById('clearBtn'),
        output: document.getElementById('output'),
        totalScore: document.getElementById('totalScore'),
        score_rr: document.getElementById('score_rr'),
        score_spO2: document.getElementById('score_spO2'),
        score_sbp: document.getElementById('score_sbp'),
        score_hr: document.getElementById('score_hr'),
        score_conscious: document.getElementById('score_conscious'),
        score_temp: document.getElementById('score_temp'),
        score_o2uplift: document.getElementById('score_o2uplift'),
        interpretEl: document.getElementById('interpret'),
        scoreTag: document.getElementById('scoreTag'),
        updatedAt: document.getElementById('updatedAt'),
        spO2Help: document.getElementById('spO2Help'),
        responseContent: document.getElementById('responseContent')
      };

      // SpO2 options
      const spO2Options = {
        scale1: [
          {v: '3', label: '≤ 91% — 3 pontos'},
          {v: '2', label: '92–93% — 2 pontos'},
          {v: '1', label: '94–95% — 1 ponto'},
          {v: '0', label: '≥ 96% — 0 pontos'}
        ],
        scale2_room: [
          {v: '3', label: '≤ 83% — 3 pontos'},
          {v: '2', label: '84–85% — 2 pontos'},
          {v: '1', label: '86–87% — 1 ponto'},
          {v: '0', label: '88–92% — 0 pontos'},
          {v: '3', label: '≥ 93% — 3 pontos'}
        ],
        scale2_supp: [
          {v: '3', label: '≤ 83% — 3 pontos'},
          {v: '2', label: '84–85% — 2 pontos'},
          {v: '1', label: '86–87% — 1 ponto'},
          {v: '0', label: '88–92% — 0 pontos'},
          {v: '1', label: '93–94% (O₂) — 1 ponto'},
          {v: '2', label: '95–96% (O₂) — 2 pontos'},
          {v: '3', label: '≥ 97% (O₂) — 3 pontos'}
        ]
      };

      function populateSpO2Options() {
        const scale = elems.spO2Scale.value;
        const source = elems.oxygenSource.value;
        const sel = elems.spO2;
        sel.innerHTML = '';
        
        let options = [];
        if (scale === '1') options = spO2Options.scale1;
        else options = source === 'room' ? spO2Options.scale2_room : spO2Options.scale2_supp;
        
        options.forEach(opt => {
          const o = document.createElement('option');
          o.value = opt.v;
          o.textContent = opt.label;
          sel.appendChild(o);
        });
        
        elems.spO2Help.textContent = `Escala ${scale} • ${source === 'supp' ? 'com O₂' : 'ar ambiente'}`;
      }

      // Templates de resposta
      const responseTemplates = {
        'low': {
          title: '0–4 — Baixo risco',
          summary: ['Monitoramento de rotina'],
          actions: [
            'Score 0: monitorar a cada 12h',
            'Score 1-4: monitorar a cada 4-6h',
            'Avaliar necessidade de aumentar frequência'
          ],
          style: 'low'
        },
        'low-medium': {
          title: 'Score 3 em um parâmetro',
          summary: ['Atenção imediata necessária'],
          actions: [
            'Monitorar a cada 1h',
            'Revisão médica urgente',
            'Avaliar intervenções imediatas'
          ],
          style: 'lowmedium'
        },
        'medium': {
          title: '5–6 — Risco moderado',
          summary: ['Revisão urgente necessária'],
          actions: [
            'Revisão por médico da enfermaria',
            'Considerar avaliação da UTI',
            'Aumentar frequência de monitorização'
          ],
          style: 'med'
        },
        'high': {
          title: '≥ 7 — Alto risco',
          summary: ['Emergência'],
          actions: [
            'Monitorização contínua',
            'Avaliação emergencial por UTI',
            'Transferência para cuidado intensivo'
          ],
          style: 'high'
        }
      };

      function interpretLevel(total, individualScores) {
        const maxParam = Math.max(...individualScores);
        if (maxParam === 3 && total < 5) return { key: 'low-medium', tpl: responseTemplates['low-medium'] };
        if (total >= 7) return { key: 'high', tpl: responseTemplates['high'] };
        if (total >= 5) return { key: 'medium', tpl: responseTemplates['medium'] };
        return { key: 'low', tpl: responseTemplates['low'] };
      }

      function renderResponse(tpl) {
        return `
          <div style="font-weight: 700; margin-bottom: 12px;">${tpl.title}</div>
          <ul style="margin: 8px 0; padding-left: 20px;">
            ${tpl.summary.map(s => `<li style="margin: 8px 0;">${s}</li>`).join('')}
          </ul>
          <div style="font-weight: 700; margin: 16px 0 8px;">O que fazer:</div>
          <ul style="margin: 0; padding-left: 20px;">
            ${tpl.actions.map(a => `<li style="margin: 8px 0;">${a}</li>`).join('')}
          </ul>
        `;
      }

      function calculateAndShow() {
        const scores = {
          rr: Number(elems.rr.value),
          sp: Number(elems.spO2.value),
          sbp: Number(elems.sbp.value),
          hr: Number(elems.hr.value),
          cons: Number(elems.conscious.value),
          temp: Number(elems.temp.value),
          o2: elems.oxygenSource.value === 'supp' ? 2 : 0
        };

        const total = scores.rr + scores.sp + scores.sbp + scores.hr + scores.cons + scores.temp + scores.o2;
        const indiv = [scores.rr, scores.sp, scores.sbp, scores.hr, scores.cons, scores.temp];
        const level = interpretLevel(total, indiv);

        // Atualizar UI
        elems.score_rr.textContent = scores.rr;
        elems.score_spO2.textContent = scores.sp;
        elems.score_sbp.textContent = scores.sbp;
        elems.score_hr.textContent = scores.hr;
        elems.score_conscious.textContent = scores.cons;
        elems.score_temp.textContent = scores.temp;
        elems.score_o2uplift.textContent = scores.o2;
        elems.totalScore.textContent = total;

        elems.interpretEl.textContent = level.tpl.title;
        elems.interpretEl.className = `interpret ${level.tpl.style}`;
        
        elems.responseContent.innerHTML = renderResponse(level.tpl);
        
        const tags = { 'high': 'ALTO', 'medium': 'MODERADO', 'low-medium': 'ATENÇÃO', 'low': 'BAIXO' };
        elems.scoreTag.textContent = tags[level.key] || '—';
        elems.updatedAt.textContent = new Date().toLocaleTimeString();
        
        elems.output.hidden = false;
        
        // Rolar suavemente até o resultado
        setTimeout(() => {
          elems.output.scrollIntoView({ behavior: 'smooth', block: 'center' });
        }, 100);
      }

      function clearAll() {
        elems.rr.selectedIndex = 2;
        elems.spO2Scale.value = '1';
        elems.oxygenSource.value = 'room';
        populateSpO2Options();
        elems.sbp.selectedIndex = 3;
        elems.hr.selectedIndex = 2;
        elems.conscious.selectedIndex = 0;
        elems.temp.selectedIndex = 2;
        elems.output.hidden = true;
      }

      // Presets
      const presets = {
        'normal': { rr:2, scale:'1', ox:'room', sp:'≥ 96', sbp:3, hr:2, cons:0, temp:2 },
        'hipoxia-leve': { rr:3, scale:'1', ox:'supp', sp:'92–93', sbp:1, hr:3, cons:1, temp:2 },
        'hipoxia-grave': { rr:4, scale:'1', ox:'supp', sp:'≤ 91', sbp:0, hr:5, cons:1, temp:3 },
        'instavel': { rr:0, scale:'2', ox:'supp', sp:'≤ 83', sbp:0, hr:0, cons:1, temp:0 },
        'bradicardia': { rr:2, scale:'1', ox:'room', sp:'≥ 96', sbp:2, hr:0, cons:0, temp:2 },
        'febre': { rr:3, scale:'1', ox:'room', sp:'94–95', sbp:3, hr:3, cons:0, temp:4 }
      };

      // Event listeners
      elems.spO2Scale.addEventListener('change', populateSpO2Options);
      elems.oxygenSource.addEventListener('change', populateSpO2Options);
      
      elems.calcBtn.addEventListener('click', calculateAndShow);
      elems.clearBtn.addEventListener('click', clearAll);

      document.querySelectorAll('.preset-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          const preset = presets[btn.dataset.preset];
          if (!preset) return;
          
          elems.rr.selectedIndex = preset.rr;
          elems.spO2Scale.value = preset.scale;
          elems.oxygenSource.value = preset.ox;
          populateSpO2Options();
          
          const options = Array.from(elems.spO2.options);
          const idx = options.findIndex(o => o.text.includes(preset.sp));
          if (idx >= 0) elems.spO2.selectedIndex = idx;
          
          elems.sbp.selectedIndex = preset.sbp;
          elems.hr.selectedIndex = preset.hr;
          elems.conscious.selectedIndex = preset.cons;
          elems.temp.selectedIndex = preset.temp;
          
          calculateAndShow();
        });
      });

      // Inicializar
      populateSpO2Options();
      clearAll();
    })();
  </script>
</body>
</html>
