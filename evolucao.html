<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
  <title>Avalia√ß√£o Fisioterap√™utica</title>
  <style>
    :root {
      --primary: #0066cc;
      --primary-dark: #004c99;
      --bg: #f8fafc;
      --card: #ffffff;
      --text: #1e293b;
      --text-light: #64748b;
      --border: #e2e8f0;
      --accent: #10b981;
      --danger: #ef4444;
    }

    * {
      box-sizing: border-box;
    }

    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
      margin: 0;
      padding: 16px;
      background: var(--bg);
      color: var(--text);
      line-height: 1.5;
      font-size: 15px;
    }

    h3 {
      margin: 28px 0 12px;
      font-size: 1.3rem;
      color: var(--primary-dark);
      border-bottom: 1px solid var(--border);
      padding-bottom: 8px;
    }

    label {
      display: block;
      margin: 0 0 6px 2px;
      font-size: 0.92rem;
      font-weight: 600;
      color: var(--text);
    }

    input[type="text"],
    input[type="number"],
    select,
    textarea {
      width: 100%;
      padding: 11px 14px;
      margin-bottom: 14px;
      border: 1px solid var(--border);
      border-radius: 10px;
      font-size: 15px;
      background: white;
      transition: border-color 0.2s, box-shadow 0.2s;
    }

    input:focus,
    select:focus,
    textarea:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(0, 102, 204, 0.15);
    }

    textarea {
      min-height: 100px;
      resize: vertical;
    }

    .section {
      background: var(--card);
      padding: 18px;
      border-radius: 12px;
      margin-bottom: 20px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.07);
      transition: transform 0.18s ease, box-shadow 0.18s ease;
    }

    .section:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }

    .row {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
      gap: 12px;
    }

    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
      gap: 14px;
    }

    .full {
      grid-column: 1 / -1;
    }

    .hidden {
      display: none !important;
    }

    select[multiple] {
      height: 160px;
      padding: 8px;
      font-size: 14px;
    }

    button {
      width: 100%;
      padding: 16px;
      font-size: 1.1rem;
      font-weight: 600;
      background: var(--primary);
      color: white;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      margin: 20px 0 12px;
      transition: all 0.25s ease;
      box-shadow: 0 3px 8px rgba(0,102,204,0.2);
    }

    button:hover {
      background: var(--primary-dark);
      transform: translateY(-2px);
      box-shadow: 0 6px 16px rgba(0,102,204,0.3);
    }

    button:active {
      transform: translateY(0);
      box-shadow: 0 2px 6px rgba(0,102,204,0.2);
    }

    #output {
      white-space: pre-wrap;
      background: white;
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 18px;
      margin: 20px 0;
      font-family: 'Segoe UI', 'Courier New', monospace;
      font-size: 14.5px;
      line-height: 1.6;
      background: linear-gradient(to bottom, #ffffff, #f9fcff);
      box-shadow: inset 0 1px 3px rgba(0,0,0,0.05);
    }

    .small-title {
      font-size: 1.05rem;
      font-weight: 600;
      margin: 14px 0 8px;
      color: var(--primary-dark);
    }

    .checkbox-group {
      margin: 14px 0;
    }

    .checkbox-group label {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 10px 0;
      font-weight: normal;
      cursor: pointer;
    }

    /* Ajustes mobile */
    @media (max-width: 640px) {
      body {
        padding: 12px;
      }
      .section {
        padding: 16px;
        margin-bottom: 16px;
      }
      input, select, textarea {
        font-size: 16px;          /* tamanho m√≠nimo confort√°vel para toque */
        padding: 13px 16px;
      }
      button {
        padding: 18px;
        font-size: 1.15rem;
      }
      .row {
        grid-template-columns: 1fr;
      }
      select[multiple] {
        height: 180px;
      }
    }
  </style>
</head>
<body>

  <div class="section">
    <label for="leito">Leito</label>
    <input type="text" id="leito" placeholder="Ex: 12" />

    <label for="estadoGeral">Estado Geral</label>
    <select id="estadoGeral">
      <option value="acordado(a) e responsivo(a)">Acordado(a) e responsivo(a)</option>
      <option value="sonolento(a), mas responsivo(a) ao chamado">Sonolento(a), mas responsivo(a)</option>
      <option value="rebaixado(a), mas responde √† dor">Rebaixado(a), mas responde √† dor</option>
      <option value="n√£o responsivo(a) a nenhum est√≠mulo">Sem resposta a est√≠mulos</option>
    </select>
  </div>

  <div class="section">
    <label for="nivelConsciencia">N√≠vel de Consci√™ncia</label>
    <select id="nivelConsciencia">
      <option value="consciente e orientado(a)">Consciente e orientado(a)</option>
      <option value="confuso(a)">Confuso(a)</option>
      <option value="agitado(a)">Agitado(a)</option>
      <option value="rebaixado(a)">Rebaixado(a)</option>
      <option value="comatoso(a)">Comatoso(a)</option>
    </select>

    <div class="checkbox-group">
      <label><input type="checkbox" id="sedado" /> Paciente sedado</label>
    </div>

    <div id="sedacaoDetalhes" class="hidden">
      <label for="rass">RASS</label>
      <select id="rass">
        <option value="-5">-5: N√£o desperta</option>
        <option value="-4">-4: Movimenta-se a est√≠mulo</option>
        <option value="-3">-3: Movimento ocular a est√≠mulo</option>
        <option value="-2">-2: Leve seda√ß√£o</option>
        <option value="-1">-1: Sonolento</option>
        <option value="0">0: Alerta e calmo</option>
        <option value="+1">+1: Inquieto</option>
        <option value="+2">+2: Agitado</option>
        <option value="+3">+3: Muito agitado</option>
        <option value="+4">+4: Combativo</option>
      </select>
    </div>
  </div>

  <div class="section">
    <label for="estadoGeralSelect">Avalia√ß√£o F√≠sica</label>
    <select id="estadoGeralSelect" multiple>
      <option value="afebril">Afebril</option>
      <option value="febril">Febril</option>
      <option value="normocorado(a)">Normocorado(a)</option>
      <option value="hipocorado(a)">Hipocorado(a)</option>
      <option value="acian√≥tico(a)">Acian√≥tico(a)</option>
      <option value="cian√≥tico(a)">Cian√≥tico(a)</option>
      <option value="hidratado(a)">Hidratado(a)</option>
      <option value="desidratado(a)">Desidratado(a)</option>
      <option value="anict√©rico(a)">Anict√©rico(a)</option>
      <option value="ict√©rico(a)">Ict√©rico(a)</option>
      <option value="extremidades quentes e perfundidas">Extremidades quentes e perfundidas</option>
      <option value="extremidades frias e hipoperfundidas">Extremidades frias e hipoperfundidas</option>
    </select>
  </div>

  <div class="section">
    <label for="sedacaoSelect">Medica√ß√µes sedativas utilizadas</label>
    <select id="sedacaoSelect" multiple>
      <option value="Fentanil">Fentanil</option>
      <option value="Midazolam">Midazolam</option>
      <option value="Ketamina">Ketamina</option>
      <option value="Propofol">Propofol</option>
      <option value="Precedex">Precedex</option>
      <option value="Morfina">Morfina</option>
    </select>

    <label for="doseSedativos">Doses ou observa√ß√µes</label>
    <input type="text" id="doseSedativos" placeholder="Ex: Fentanil 100mcg/h, Propofol 20ml/h">
  </div>

  <div class="section">
    <div class="checkbox-group">
      <label><input type="checkbox" id="usaDVA"> Uso de drogas vasoativas</label>
    </div>

    <div id="dvaGrupo" class="hidden">
      <label for="drogaVasoativa">Drogas (selecione todas que estiver usando)</label>
      <select id="drogaVasoativa" multiple size="6">
        <option value="Noradrenalina">Noradrenalina</option>
        <option value="Vasopressina">Vasopressina</option>
        <option value="Dobutamina">Dobutamina</option>
        <option value="Adrenalina">Adrenalina</option>
        <option value="Nipride">Nipride</option>
        <option value="Tridil">Tridil</option>
      </select>

      <label for="doseDVA">Dose e observa√ß√µes</label>
      <textarea id="doseDVA" rows="3" placeholder="Ex: Noradrenalina 0,1 mcg/kg/min; Vasopressina 0,04 UI/min..."></textarea>
    </div>
  </div>

  <div class="section">
    <label for="ventilacao">Ventila√ß√£o</label>
    <select id="ventilacao">
      <option value="em ar ambiente">Ar ambiente</option>
      <option value="em O2 suplementar">O2 suplementar</option>
      <option value="em ventila√ß√£o mec√¢nica">Ventila√ß√£o mec√¢nica</option>
    </select>

    <input type="text" id="oxigenioDetalhe" placeholder="Detalhe: cateter, m√°scara, VM..." />

    <div id="vmDetalhes" class="row hidden" style="margin-top: 12px;">
      <select id="modoVM">
        <option value="">Modo</option>
        <option value="PCV">PCV</option>
        <option value="PRVC">PRVC</option>
        <option value="VCV">VCV</option>
        <option value="PSV">PSV</option>
        <option value="PAV">PAV</option>
        <option value="APRV">APRV</option>
        <option value="SIMV">SIMV</option>
      </select>
      <input type="text" id="pinsp" placeholder="Pinsp/PS" />
      <input type="text" id="peep" placeholder="PEEP" />
      <input type="text" id="fio2" placeholder="FiO‚ÇÇ %" />
      <input type="text" id="vc" placeholder="VT (mL)" />
      <input type="text" id="frVM" placeholder="FR VM" />
    </div>

    <div id="vmCalc" class="hidden">
      <div class="grid">
        <div>
          <label for="sexo">Sexo</label>
          <select id="sexo">
            <option value="">-- selecione --</option>
            <option value="M">Masculino</option>
            <option value="F">Feminino</option>
          </select>
        </div>
        <div>
          <label for="altura">Altura (cm)</label>
          <input type="number" id="altura" placeholder="Ex: 170" />
        </div>
        <div>
          <label for="peso">Peso atual (kg) ‚Äî opcional</label>
          <input type="number" id="peso" placeholder="Ex: 70" />
        </div>
        <div>
          <label for="plat">Press√£o de Plat√¥ (cmH‚ÇÇO)</label>
          <input type="number" id="plat" placeholder="Ex: 24" />
        </div>
        <div class="full">
          <small>Obs: PBW (Peso Predito) calculado por sexo/altura. VT informado em mL ‚Äî ser√° convertido para mL/kg de PBW.</small>
        </div>
      </div>
    </div>
  </div>

  <div class="section">
    <div class="row">
      <input type="number" id="fc" placeholder="FC bpm" />
      <input type="text" id="pa" placeholder="PA mmHg" />
      <input type="number" id="fr" placeholder="FR irpm" />
      <input type="number" id="spo2" placeholder="SpO‚ÇÇ %" />
      <input type="number" id="temp" placeholder="Temp ¬∞C" />
    </div>
  </div>

  <div class="section">
    <label for="exameRespiratorio">Exame Respirat√≥rio</label>
    <select id="exameRespiratorio" multiple>
      <option value="MV preservado sem ru√≠dos advent√≠cios">MV preservado sem ru√≠dos advent√≠cios</option>
      <option value="MV com presen√ßa de">MV com presen√ßa de</option>
      <option value="MV reduzido">MV reduzido</option>
      <option value="roncos">roncos</option>
      <option value="sibilos">sibilos</option>
      <option value="estertores crepitantes">estertores crepitantes</option>
      <option value="MV abolido">MV abolido</option>
      <option value="globalmente">globalmente</option>
      <option value="em base direita">em base direita</option>
      <option value="em base esquerda">em base esquerda</option>
      <option value="em √°pice direito">em √°pice direito</option>
      <option value="em √°pice esquerdo">em √°pice esquerdo</option>
      <option value="√† Direita">em HTX D</option>
      <option value="√† esquerda">em HTX E</option>
    </select>

    <label for="exameAbdominal">Exame Abdominal</label>
    <select id="exameAbdominal" multiple>
      <option value="Plano">Plano</option>
      <option value="Distendido">Distendido</option>
      <option value="Fl√°cido">Fl√°cido</option>
      <option value="Tenso">Tenso</option>
      <option value="Doloroso √† palpa√ß√£o">Doloroso √† palpa√ß√£o</option>
      <option value="Sem dor √† palpa√ß√£o">Sem presen√ßa de dor</option>
    </select>
  </div>

  <div class="section">
    <div class="small-title">Mobilidade / Escalas</div>
    <input type="text" id="ims" placeholder="IMS (ex: 0 a 10)" />
    <input type="text" id="mrc" placeholder="MRC (ex: 0 a 60)" />
  </div>

  <div class="section">
    <label for="condutas">Condutas fisioterap√™uticas</label>
    <select id="condutas" multiple size="8">
      <option>Desobstru√ß√£o br√¥nquica</option>
      <option>Reexpans√£o pulmonar</option>
      <option>Treino muscular respirat√≥rio</option>
      <option>Ventila√ß√£o n√£o invasiva</option>
      <option>Avalia√ß√£o para decanula√ß√£o</option>
      <option>Recusou atendimento</option>
      <option>Sem atendimento</option>
      <option>Adequa√ß√£o postural</option>
      <option>Ajustes ventilat√≥rios</option>
      <option>Alongamento</option>
      <option>Cicloerg√¥metro em MMSS</option>
      <option>Cicloerg√¥metro em MMII</option>
      <option>Deambula√ß√£o com aux√≠lio</option>
      <option>Deambula√ß√£o sob supervis√£o</option>
      <option>Desmame ventilat√≥rio</option>
      <option>Drenagem postural</option>
      <option>Eletroterapia</option>
      <option>Extuba√ß√£o</option>
      <option>Fortalecimento de MMSS</option>
      <option>Fortalecimento de MMII</option>
      <option>Incentivadores inspirat√≥rios</option>
      <option>Monitoriza√ß√£o dos sinais vitais</option>
      <option>Padr√µes ventilat√≥rios</option>
      <option>Sedesta√ß√£o √† beira do leito</option>
      <option>Sedesta√ß√£o na poltrona</option>
      <option>Suporte VNI</option>
      <option>Treinamento muscular respirat√≥rio</option>
      <option>Treino de controle de tronco</option>
      <option>Treino de equil√≠brio</option>
      <option>Treino de marcha</option>
      <option>Treino de marcha de andador</option>
      <option>Treino de marcha de muleta</option>
      <option>Treino de ortostase</option>
    </select>
  </div>

  <div class="section">
    <label for="obsFinais">Observa√ß√µes Finais</label>
    <textarea id="obsFinais" rows="3" placeholder="Digite aqui..."></textarea>
  </div>

  <div class="section">
    <h3>Exames laboratoriais</h3>
    <div class="grid">
      <div>
        <label for="hb">Hemoglobina (g/dL)</label>
        <input type="number" step="0.1" id="hb" placeholder="Ex: 9.8" />
      </div>
      <div>
        <label for="plaquetas">Plaquetas (x10¬≥/uL)</label>
        <input type="number" id="plaquetas" placeholder="Ex: 150" />
      </div>
      <div>
        <label for="bastoes">Bast√µes (%)</label>
        <input type="number" step="0.1" id="bastoes" placeholder="Ex: 3" />
      </div>
      <div>
        <label for="leucograma">Leucograma (obs/texto)</label>
        <input type="text" id="leucograma" placeholder="Ex: Leucocitose √† direita..." />
      </div>
      <div>
        <label for="lactato">Lactato (mmol/L)</label>
        <input type="number" step="0.1" id="lactato" placeholder="Ex: 1.2" />
      </div>
      <div>
        <label for="creatinina">Creatinina (mg/dL)</label>
        <input type="number" step="0.1" id="creatinina" placeholder="Ex: 1.2" />
      </div>
      <div>
        <label for="ureia">Ureia (mg/dL)</label>
        <input type="number" step="0.1" id="ureia" placeholder="Ex: 45" />
      </div>
      <div>
        <label for="sodio">S√≥dio (mEq/L)</label>
        <input type="number" step="0.1" id="sodio" placeholder="Ex: 140" />
      </div>
      <div>
        <label for="potassio">Pot√°ssio (mEq/L)</label>
        <input type="number" step="0.1" id="potassio" placeholder="Ex: 4.2" />
      </div>
      <div class="full">
        <label for="examesTexto">Lista textual completa de exames</label>
        <textarea id="examesTexto" rows="4" placeholder="Cole aqui o laudo ou lista completa..."></textarea>
      </div>
    </div>
  </div>

  <div class="section">
    <h3>Gasometria arterial / venosa</h3>
    <div class="grid">
      <div>
        <label for="amostra">Amostra</label>
        <select id="amostra">
          <option value="arterial">Arterial</option>
          <option value="venosa">Venosa</option>
        </select>
      </div>
      <div>
        <label for="ph">pH</label>
        <input type="number" step="0.01" id="ph" placeholder="Ex: 7.38" />
      </div>
      <div>
        <label for="paco2">PaCO‚ÇÇ (mmHg)</label>
        <input type="number" step="0.1" id="paco2" placeholder="Ex: 40" />
      </div>
      <div>
        <label for="pao2">PaO‚ÇÇ (mmHg)</label>
        <input type="number" step="0.1" id="pao2" placeholder="Ex: 80" />
      </div>
      <div>
        <label for="hco3">HCO‚ÇÉ‚Åª (mEq/L)</label>
        <input type="number" step="0.1" id="hco3" placeholder="Ex: 24" />
      </div>
      <div>
        <label for="saturacao">Sat %</label>
        <input type="number" step="0.1" id="saturacao" placeholder="Ex: 95" />
      </div>
      <div class="full">
        <small>Informe FiO‚ÇÇ no painel de VM (ou texto de O‚ÇÇ suplementar) para c√°lculo de PaO‚ÇÇ/FiO‚ÇÇ.</small>
      </div>
    </div>
  </div>

  <button onclick="gerarEvolucao()">Gerar Evolu√ß√£o</button>

  <div id="output" class="output"></div>

  <button onclick="copiarEvolucao()">üìã Copiar Evolu√ß√£o</button>

  <script>
    // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    // Seu JavaScript original mantido INTEGRALMENTE
    // Apenas adicionadas transi√ß√µes suaves visuais
    // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

    document.getElementById("sedado").addEventListener("change", function () {
      const el = document.getElementById("sedacaoDetalhes");
      if (this.checked) {
        el.classList.remove("hidden");
        el.style.opacity = "0";
        setTimeout(() => { el.style.opacity = "1"; }, 10);
      } else {
        el.style.opacity = "0";
        setTimeout(() => { el.classList.add("hidden"); }, 200);
      }
    });

    document.getElementById("ventilacao").addEventListener("change", function () {
      const show = this.value === "em ventila√ß√£o mec√¢nica";
      const vmDetalhes = document.getElementById("vmDetalhes");
      const vmCalc = document.getElementById("vmCalc");

      if (show) {
        vmDetalhes.classList.remove("hidden");
        vmCalc.classList.remove("hidden");
      } else {
        vmDetalhes.classList.add("hidden");
        vmCalc.classList.add("hidden");
      }
    });

    document.getElementById("usaDVA").addEventListener("change", function () {
      const el = document.getElementById("dvaGrupo");
      if (this.checked) {
        el.classList.remove("hidden");
      } else {
        el.classList.add("hidden");
      }
    });

    function copiarEvolucao() {
      const output = document.getElementById("output");
      const texto = output.innerText || output.textContent;
      if (texto.trim() === "") {
        alert("Nada para copiar.");
        return;
      }
      const temp = document.createElement("textarea");
      temp.value = texto;
      document.body.appendChild(temp);
      temp.select();
      document.execCommand("copy");
      document.body.removeChild(temp);
      alert("Evolu√ß√£o copiada para a √°rea de transfer√™ncia!");
    }

    function gerarCondutasTexto() {
      const select = document.getElementById("condutas");
      const condutas = Array.from(select.selectedOptions).map(opt => opt.value);
      return condutas.length ? `Condutas realizadas: ${condutas.join(", ")}.` : "";
    }

    function interpretarLabs(vals) {
      const out = [];
      const hb = vals.hb;
      if (!isNaN(hb)) {
        if (hb < 7) out.push(`Hemoglobina ${hb} g/dL ‚Äî anemia grave (avaliar transfus√£o conforme conduta cl√≠nica).`);
        else if (hb < 9) out.push(`Hemoglobina ${hb} g/dL ‚Äî anemia moderada.`);
        else if (hb < 12) out.push(`Hemoglobina ${hb} g/dL ‚Äî leve redu√ß√£o.`);
        else out.push(`Hemoglobina ${hb} g/dL ‚Äî valor dentro do intervalo esperado.`);
      }
      const plaq = vals.plaquetas;
      if (!isNaN(plaq)) {
        if (plaq < 20) out.push(`Plaquetas ${plaq} x10¬≥ ‚Äî trombocitopenia muito grave (alto risco hemorr√°gico).`);
        else if (plaq < 50) out.push(`Plaquetas ${plaq} x10¬≥ ‚Äî trombocitopenia grave.`);
        else if (plaq < 150) out.push(`Plaquetas ${plaq} x10¬≥ ‚Äî trombocitopenia moderada.`);
        else out.push(`Plaquetas ${plaq} x10¬≥ ‚Äî contagem dentro do esperado.`);
      }
      const bast = vals.bastoes;
      if (!isNaN(bast)) {
        if (bast > 10) out.push(`Bast√µes ${bast}% ‚Äî importante desvio √† esquerda (sugere resposta inflamat√≥ria/aguda).`);
        else if (bast > 3) out.push(`Bast√µes ${bast}% ‚Äî leve desvio √† esquerda.`);
        else out.push(`Bast√µes ${bast}% ‚Äî sem desvio significativo.`);
      }
      const leuc = vals.leucograma && vals.leucograma.trim();
      if (leuc) out.push(`Leucograma: ${leuc}.`);
      const lac = vals.lactato;
      if (!isNaN(lac)) {
        if (lac >= 4) out.push(`Lactato ${lac} mmol/L ‚Äî hiperlactatemia marcada (alto risco / hipoperfus√£o).`);
        else if (lac > 2) out.push(`Lactato ${lac} mmol/L ‚Äî lactato elevado (sugere hipoperfus√£o/estr√©s metab√≥lico).`);
        else out.push(`Lactato ${lac} mmol/L ‚Äî dentro do esperado.`);
      }
      const cr = vals.creatinina;
      if (!isNaN(cr)) {
        if (cr > 2.0) out.push(`Creatinina ${cr} mg/dL ‚Äî eleva√ß√£o acentuada, sugestiva de les√£o renal aguda ou cr√¥nica descompensada; avaliar d√©bito urin√°rio, medicamentos nefrot√≥xicos e conduta nefrol√≥gica.`);
        else if (cr > 1.3) out.push(`Creatinina ${cr} mg/dL ‚Äî eleva√ß√£o discreta a moderada, poss√≠vel disfun√ß√£o renal; correlacionar com ureia, tend√™ncia temporal e quadro cl√≠nico.`);
        else out.push(`Creatinina ${cr} mg/dL ‚Äî dentro do intervalo esperado.`);
      }
      const ure = vals.ureia;
      if (!isNaN(ure)) {
        if (ure > 80) out.push(`Ureia ${ure} mg/dL ‚Äî azotemia elevada (sugere insufici√™ncia renal/prerenal).`);
        else if (ure > 40) out.push(`Ureia ${ure} mg/dL ‚Äî aumento moderado da ureia.`);
        else out.push(`Ureia ${ure} mg/dL ‚Äî dentro do esperado.`);
      }
      const na = vals.sodio;
      if (!isNaN(na)) {
        if (na < 130) out.push(`S√≥dio ${na} mEq/L ‚Äî hiponatremia.`);
        else if (na > 150) out.push(`S√≥dio ${na} mEq/L ‚Äî hipernatremia.`);
        else out.push(`S√≥dio ${na} mEq/L ‚Äî dentro do intervalo esperado.`);
      }
      const k = vals.potassio;
      if (!isNaN(k)) {
        if (k < 3.0) out.push(`Pot√°ssio ${k} mEq/L ‚Äî risco de hipocalemia (verificar ECG e reposi√ß√£o conforme protocolo).`);
        else if (k > 5.5) out.push(`Pot√°ssio ${k} mEq/L ‚Äî risco de hipercalemia (verificar ECG e medidas).`);
        else out.push(`Pot√°ssio ${k} mEq/L ‚Äî dentro do intervalo esperado.`);
      }
      return out.join(" ");
    }

    function interpretarGasometria(gas, fio2Pct, ventilado, vmParams, pbw) {
      const out = [];
      const ph = gas.ph;
      const paco2 = gas.paco2;
      const hco3 = gas.hco3;
      const pao2 = gas.pao2;
      const sat = gas.saturacao;
      const amostra = gas.amostra;

      if (!isNaN(ph)) {
        if (ph < 7.35) out.push(`Acidose (pH ${ph}).`);
        else if (ph > 7.45) out.push(`Alcalose (pH ${ph}).`);
        else out.push(`pH ${ph} dentro do normal.`);
      }

      if (!isNaN(paco2) && !isNaN(hco3)) {
        if (ph < 7.35) {
          if (paco2 > 45 && hco3 >= 22) out.push(`Acidose predominantemente respirat√≥ria (PaCO‚ÇÇ ${paco2} mmHg).`);
          else if (hco3 < 22 && paco2 <= 45) out.push(`Acidose predominantemente metab√≥lica (HCO‚ÇÉ ${hco3}).`);
          else out.push(`Acidose mista ou compensa√ß√£o presente (PaCO‚ÇÇ ${paco2}, HCO‚ÇÉ ${hco3}).`);
        } else if (ph > 7.45) {
          if (paco2 < 35 && hco3 <= 28) out.push(`Alcalose respirat√≥ria prov√°vel (PaCO‚ÇÇ ${paco2} mmHg).`);
          else if (hco3 > 28 && paco2 >= 35) out.push(`Alcalose metab√≥lica prov√°vel (HCO‚ÇÉ ${hco3}).`);
          else out.push(`Alcalose mista ou compensa√ß√£o presente (PaCO‚ÇÇ ${paco2}, HCO‚ÇÉ ${hco3}).`);
        } else {
          out.push(`pH normal com PaCO‚ÇÇ ${paco2} e HCO‚ÇÉ ${hco3} ‚Äî poss√≠vel compensa√ß√£o.`);
        }
      } else if (!isNaN(paco2)) {
        out.push(`PaCO‚ÇÇ ${paco2} mmHg.`);
      }

      if (!isNaN(pao2)) {
        if (!isNaN(fio2Pct) && fio2Pct > 0) {
          const fio2 = fio2Pct / 100;
          const pf = pao2 / fio2;
          out.push(`PaO‚ÇÇ ${pao2} mmHg. PaO‚ÇÇ/FiO‚ÇÇ ‚âà ${Math.round(pf)}.`);
          if (pf <= 100) out.push(`Rela√ß√£o P/F ‚â§100: hip√≥xia grave (potencial SDRA grave).`);
          else if (pf <= 200) out.push(`P/F 100‚Äì200: hip√≥xia moderada (SDRA moderado poss√≠vel).`);
          else if (pf <= 300) out.push(`P/F 200‚Äì300: hipoxemia leve (SDRA leve poss√≠vel).`);
          else out.push(`P/F >300: oxigena√ß√£o aceit√°vel para ambiente hospitalar.`);
        } else {
          out.push(`PaO‚ÇÇ ${pao2} mmHg (FiO‚ÇÇ n√£o informada para c√°lculo P/F).`);
        }
      }

      if (!isNaN(sat)) out.push(`Satura√ß√£o ${sat}%.`);

      if (ventilado) {
        if (!isNaN(paco2)) {
          if (paco2 > 50) out.push(`PaCO‚ÇÇ elevado (${paco2} mmHg) ‚Äî hipoventila√ß√£o relativa (avaliar Vt, FR e sincronia).`);
          else if (paco2 < 30) out.push(`PaCO‚ÇÇ baixo (${paco2} mmHg) ‚Äî hiperventila√ß√£o (avaliar seda√ß√£o, suporte ventilat√≥rio).`);
        }
        const vt = vmParams.vt;
        if (!isNaN(vt) && !isNaN(pbw) && pbw > 0) {
          const vtkg = vt / pbw;
          out.push(`VT informado ${vt} mL ‚Äî corresponde a ${vtkg.toFixed(2)} mL/kg de PBW (${pbw.toFixed(1)} kg).`);
          if (vtkg > 8) out.push(`VT >8 mL/kg ‚Äî acima do alvo de ventila√ß√£o protetora; sugerir reduzir para 6‚Äì8 mL/kg se compat√≠vel com quadro cl√≠nico.`);
          else if (vtkg < 6) out.push(`VT <6 mL/kg ‚Äî abaixo do alvo (aten√ß√£o se hipoventila√ß√£o/hipercapnia).`);
          else out.push(`VT dentro do alvo protetor (6‚Äì8 mL/kg).`);
        } else {
          out.push(`VT ou PBW indispon√≠veis para c√°lculo de VT/kg.`);
        }
        const plat = vmParams.plat;
        if (!isNaN(plat)) {
          out.push(`Press√£o de Plat√¥ ${plat} cmH‚ÇÇO.`);
          if (plat > 30) out.push(`Pplat >30 cmH‚ÇÇO ‚Äî risco de volutrauma/les√£o pulmonar ventilat√≥rio-associada (avaliar redu√ß√£o de VT).`);
        }
      }

      return out.join(" ");
    }

    function calcularPBW(sexo, alturaCm) {
      if (!alturaCm || alturaCm <= 0 || (sexo !== "M" && sexo !== "F")) return NaN;
      return (sexo === "M")
        ? 50 + 0.91 * (alturaCm - 152.4)
        : 45.5 + 0.91 * (alturaCm - 152.4);
    }

    function gerarEvolucao() {
      const estadoGeral = document.getElementById("estadoGeral").value;
      const consciencia = document.getElementById("nivelConsciencia").value;
      const sedado = document.getElementById("sedado").checked;
      const rass = document.getElementById("rass").value;
      const sedacaoTexto = sedado ? ` Paciente sedado, RASS: ${rass}.` : "";

      const estadoGeralnovo = Array.from(document.getElementById("estadoGeralSelect").selectedOptions).map(option => option.value);
      const sedativos = Array.from(document.getElementById("sedacaoSelect").selectedOptions).map(option => option.value);
      const doseSedativos = document.getElementById("doseSedativos").value;

      const ventilacao = document.getElementById("ventilacao").value;
      const oxigenioDetalhe = document.getElementById("oxigenioDetalhe").value;

      const modoVM = document.getElementById("modoVM").value;
      const pinsp = document.getElementById("pinsp").value;
      const peep = document.getElementById("peep").value;
      const fio2 = parseFloat(document.getElementById("fio2").value);
      const vc = parseFloat(document.getElementById("vc").value);
      const frVM = document.getElementById("frVM").value;
      const plat = parseFloat(document.getElementById("plat").value);
      const sexo = document.getElementById("sexo").value;
      const altura = parseFloat(document.getElementById("altura").value);
      const peso = parseFloat(document.getElementById("peso").value);

      let parametrosVM = "";
      if (ventilacao === "em ventila√ß√£o mec√¢nica") {
        parametrosVM = "Par√¢metros ventilat√≥rios:";
        if (modoVM) parametrosVM += ` modo ${modoVM},`;
        if (pinsp) parametrosVM += ` Pinsp/PS ${pinsp},`;
        if (peep) parametrosVM += ` PEEP ${peep},`;
        if (!isNaN(fio2)) parametrosVM += ` FiO‚ÇÇ ${fio2}%,`;
        if (!isNaN(vc)) parametrosVM += ` VT ${vc} mL,`;
        if (frVM) parametrosVM += ` FR ${frVM} irpm,`;
        if (!isNaN(plat)) parametrosVM += ` Pplat ${plat} cmH‚ÇÇO,`;
        parametrosVM = parametrosVM.replace(/,+$/, ".");
      }

      const fc = document.getElementById("fc").value;
      const pa = document.getElementById("pa").value;
      const fr = document.getElementById("fr").value;
      const spo2 = document.getElementById("spo2").value;
      const temp = document.getElementById("temp").value;

      const exameRespiratorio = Array.from(document.getElementById("exameRespiratorio").selectedOptions).map(opt => opt.value).join(" ");
      const exameAbdominal = Array.from(document.getElementById("exameAbdominal").selectedOptions).map(opt => opt.value).join(" ");

      const ims = document.getElementById("ims").value;
      const mrc = document.getElementById("mrc").value;

      const mobilidadeTexto = (ims || mrc)
        ? `Mobilidade: IMS ${ims || "-"}, MRC ${mrc || "-"}.`
        : "";

      const condutaTexto = gerarCondutasTexto();

      const leito = document.getElementById("leito").value || "n√£o informado";

      const hb = parseFloat(document.getElementById("hb").value);
      const plaquetas = parseFloat(document.getElementById("plaquetas").value);
      const bastoes = parseFloat(document.getElementById("bastoes").value);
      const leucograma = document.getElementById("leucograma").value;
      const lactato = parseFloat(document.getElementById("lactato").value);
      const creatinina = parseFloat(document.getElementById("creatinina").value);
      const ureia = parseFloat(document.getElementById("ureia").value);
      const sodio = parseFloat(document.getElementById("sodio").value);
      const potassio = parseFloat(document.getElementById("potassio").value);
      const examesTexto = document.getElementById("examesTexto").value;

      const amostra = document.getElementById("amostra").value;
      const ph = parseFloat(document.getElementById("ph").value);
      const paco2 = parseFloat(document.getElementById("paco2").value);
      const pao2 = parseFloat(document.getElementById("pao2").value);
      const hco3 = parseFloat(document.getElementById("hco3").value);
      const saturacao = parseFloat(document.getElementById("saturacao").value);

      const pbw = calcularPBW(sexo, altura);

      let texto = `Paciente internado na UTI, leito ${leito}, ${estadoGeral}. Apresenta-se ${consciencia}.${sedacaoTexto}\n`;

      if (estadoGeralnovo.length > 0) {
        texto += `Avalia√ß√£o f√≠sica: ${estadoGeralnovo.join(', ')}.\n`;
      }

      if (sedativos.length > 0 || doseSedativos) {
        texto += `Seda√ß√£o: ${sedativos.join(', ')}.`;
        if (doseSedativos) texto += ` Observa√ß√µes: ${doseSedativos}.`;
        texto += `\n`;
      }

      if (document.getElementById("usaDVA").checked) {
        const drogas = Array.from(document.getElementById("drogaVasoativa").selectedOptions).map(opt => opt.value);
        const doseObs = document.getElementById("doseDVA").value.trim();
        if (drogas.length > 0) {
          texto += `Com necessidade de: ${drogas.join(", ")}.`;
          if (doseObs) texto += ` Doses/observa√ß√µes: ${doseObs}.`;
          texto += `\n`;
        } else {
          texto += `Uso de drogas vasoativas informado, por√©m nenhuma droga selecionada.\n`;
        }
      }

      texto += `Encontra-se ${ventilacao}${oxigenioDetalhe ? ", utilizando: " + oxigenioDetalhe : ""}.\n`;
      if (parametrosVM) texto += parametrosVM + "\n";

      texto += `Sinais vitais: FC ${fc} bpm, PA ${pa}, FR ${fr} irpm, SpO‚ÇÇ ${spo2}%, T¬∫ ${temp}¬∞C.\n`;
      texto += `Exame respirat√≥rio: ${exameRespiratorio || "sem altera√ß√µes relevantes"}.\n`;
      texto += `Exame abdominal: ${exameAbdominal || "sem altera√ß√µes relevantes"}.\n`;

      if (mobilidadeTexto) texto += mobilidadeTexto + '\n';
      if (condutaTexto) texto += condutaTexto + '\n';

      texto += `\n--- Exames laboratoriais (principais) ---\n`;
      if (!isNaN(hb)) texto += `Hb: ${hb} g/dL. `;
      if (!isNaN(plaquetas)) texto += `Plaquetas: ${plaquetas} x10¬≥. `;
      if (!isNaN(bastoes)) texto += `Bast√µes: ${bastoes}%. `;
      if (leucograma) texto += `Leucograma: ${leucograma}. `;
      if (!isNaN(lactato)) texto += `Lactato: ${lactato} mmol/L. `;
      if (!isNaN(creatinina)) texto += `Creatinina: ${creatinina} mg/dL. `;
      if (!isNaN(ureia)) texto += `Ureia: ${ureia} mg/dL. `;
      if (!isNaN(sodio)) texto += `Na‚Å∫: ${sodio} mEq/L. `;
      if (!isNaN(potassio)) texto += `K‚Å∫: ${potassio} mEq/L. `;
      if (examesTexto && examesTexto.trim() !== "") {
        texto += `\nObserva√ß√µes/Laudo: ${examesTexto}\n`;
      } else {
        texto += `\n`;
      }

      texto += `\n--- Interpreta√ß√£o laboratorial (autom√°tica) ---\n`;
      const labsInterpret = interpretarLabs({
        hb, plaquetas, bastoes, leucograma,
        lactato, creatinina, ureia, sodio, potassio
      });
      texto += labsInterpret + "\n";

      texto += `\n--- Gasometria (${amostra}) ---\n`;
      const gasInterpret = interpretarGasometria({
        ph, paco2, pao2, hco3, saturacao, amostra
      }, fio2, ventilacao === "em ventila√ß√£o mec√¢nica", { vt: isNaN(vc) ? NaN : vc, plat: isNaN(plat) ? NaN : plat }, pbw);
      texto += gasInterpret + "\n";

      texto += `\n--- Correla√ß√µes e recomenda√ß√µes (VM) ---\n`;
      if (ventilacao === "em ventila√ß√£o mec√¢nica") {
        if (isNaN(pbw)) {
          texto += `PBW: n√£o calculado (sexo/altura ausentes). Informe sexo e altura para avalia√ß√£o de VT/kg.\n`;
        } else {
          texto += `PBW calculado: ${pbw.toFixed(1)} kg.\n`;
        }
        if (!isNaN(vc) && !isNaN(pbw) && pbw > 0) {
          const vtkg = vc / pbw;
          texto += `VT atual: ${vc} mL ‚Üí ${vtkg.toFixed(2)} mL/kg PBW.\n`;
          if (vtkg > 8) texto += `Sugerido: reduzir VT para intervalo protetor (6‚Äì8 mL/kg PBW) se clinicamente poss√≠vel.\n`;
          else texto += `VT dentro do alvo protetor (6‚Äì8 mL/kg) ou pr√≥ximo.\n`;
        } else {
          texto += `VT ou PBW n√£o dispon√≠veis para c√°lculo exato de VT/kg.\n`;
        }
        if (!isNaN(plat)) {
          texto += `Pplat: ${plat} cmH‚ÇÇO.`;
          if (plat > 30) texto += ` Aten√ß√£o: Pplat >30 cmH‚ÇÇO ‚Äî considerar ajustes (redu√ß√£o de VT) para evitar volutrauma.\n`;
          else texto += ` Pplat dentro do alvo (‚â§30 cmH‚ÇÇO).\n`;
        } else {
          texto += `Pplat n√£o informado.\n`;
        }
        if (!isNaN(paco2)) {
          if (paco2 > 50) texto += `PaCO‚ÇÇ elevado ‚Äî revisar ventila√ß√£o (aumentar FR/VT se essencial) e avaliar causa (dead space, hipoventila√ß√£o, seda√ß√£o).`;
          else if (paco2 < 30) texto += `PaCO‚ÇÇ baixo ‚Äî avaliar possibilidade de hiperventila√ß√£o (seda√ß√£o, modo ventilat√≥rio).`;
        }
        texto += `\n`;
      } else {
        texto += `Paciente n√£o em ventila√ß√£o mec√¢nica ‚Äî correla√ß√µes com VM n√£o aplic√°veis.\n`;
      }

      const obsFinais = document.getElementById("obsFinais").value;
      if (obsFinais.trim() !== "") {
        texto += `\nObs.: ${obsFinais}\n`;
      }

      document.getElementById("output").innerText = texto;
    }
  </script>
</body>
</html>
